# Design Options: 인터페이스 및 인터랙션 설계

**기능**: Slack 사용자 인터랙션 및 Google OAuth 인증 흐름 설계
**작성일**: 2026-01-07
**상태**: ⏳ 결정 대기중

---

## 📋 개요
사용자가 Panager와 상호작용하는 **Slack Interface**와 서비스를 사용하기 위한 **인증 흐름(Authentication Flow)**을 정의합니다.
시스템 복잡도를 최소화하면서 사용자 경험(UX)을 극대화하는 방안을 모색합니다.

---

## 🎯 요구사항

1. **Slack Interaction**
   - 보안상 안전하게 요청을 검증해야 함 (Signing Secret).
   - Slack의 3초 타임아웃 규칙을 준수해야 함 (비동기 처리 필수).
   - 사용자가 직관적으로 기능을 실행할 수 있어야 함.

2. **Authentication Flow**
   - Slack 사용자와 Google 계정을 안전하게 매핑해야 함.
   - 인증 완료 시 사용자에게 피드백을 주어야 함.

---

## 🏗️ 설계 옵션 1: Slack 요청 처리 방식

Slack은 서버가 3초 이내에 응답하지 않으면 에러로 간주하거나 재전송합니다.

### 🔹 방안 A: FastAPI BackgroundTasks (추천)
요청 수신 즉시 `200 OK`를 반환하고, 실제 로직은 백그라운드 스레드에서 처리합니다.

- **장점**: 구현이 매우 간단함. 추가 인프라(Redis 등) 불필요. 단일 인스턴스 환경에 적합.
- **단점**: 서버 재시작 시 진행 중인 작업 유실 가능성. 대규모 트래픽 처리 한계.
- **적합성**: ⭐⭐⭐⭐⭐ (현재 프로젝트 규모에 최적)

### 🔹 방안 B: Message Queue (Celery/Redis)
요청을 큐에 넣고 워커 프로세스가 처리합니다.

- **장점**: 높은 신뢰성, 확장성. 작업 재시도 용이.
- **단점**: Redis 등 인프라 관리 부담. 설정 복잡도 증가.
- **적합성**: ⭐⭐ (오버엔지니어링 가능성)

---

## 🏗️ 설계 옵션 2: 인증 시작/명령 방식

사용자가 어떻게 Google 연동을 시작하고, 기능을 호출할지 결정합니다.

### 🔹 방안 A: Slash Command (`/panager`) (추천)
Slack의 표준 명령어 시스템을 사용합니다.
- `/panager connect`: 로그인 링크 발급 (Ephemeral 메시지로 나만 보이게)
- `/panager sync`: 즉시 동기화
- `/panager status`: 연결 상태 확인

- **장점**: 자동완성 지원, 명시적 실행, 보안성 높음(Ephemeral).
- **단점**: Slack App 설정에서 미리 커맨드를 등록해야 함 (매니페스트 관리).

### 🔹 방안 B: Bot Mention (`@Panager`)
봇을 멘션하여 대화하듯 명령합니다.
- `@Panager 연결해줘`

- **장점**: 자연어 처리(LLM)와 결합하기 좋음. 유연함.
- **단점**: 명령 의도 파악 로직 필요. 공개 채널에서 인증 링크 노출 위험(DM 유도 필요).

### 🔹 방안 C: DM & 자연어 처리 (사용자 선택)
봇과의 1:1 대화(DM)에서 자연어 메시지를 입력받아 의도를 파악하고 처리합니다.
- "계정 연결해줘" -> 인증 링크 발송
- "내일 일정 알려줘" -> 일정 조회

- **장점**: 사용자 친화적(Conversational UI). Slash Command를 외울 필요 없음.
- **단점**: LLM 또는 키워드 매칭 로직 필요.

---

## 🏗️ 설계 옵션 3: 인증 완료 후 UX

Google 인증 완료 후 웹 브라우저와 Slack에서의 동작입니다.

### 🔹 방안 A: 웹 페이지 + DM 알림 (표준)
1. 사용자가 브라우저에서 로그인 성공.
2. 브라우저는 "인증이 완료되었습니다. 창을 닫으셔도 됩니다." 페이지 표시.
3. 서버는 백그라운드에서 Slack DM으로 "✅ Google 계정이 연결되었습니다!" 메시지 발송.

- **장점**: 명확한 피드백. Slack으로 돌아오게 유도.
- **단점**: 사용자가 직접 창을 닫고 Slack으로 이동해야 함.

### 🔹 방안 B: Slack Deep Link 리다이렉트 (사용자 선택)
1. 로그인 성공 후 `slack://user?team={TEAM_ID}&id={USER_ID}` 또는 `slack://app?team={TEAM_ID}&id={APP_ID}`로 리다이렉트.

- **장점**: 자동으로 Slack 앱으로 전환됨. 모바일 경험 우수.
- **단점**: 데스크탑/모바일 환경 파편화 대응 필요.

---

## 📊 종합 비교 및 추천

| 구분 | 방안 A | 방안 B |
|------|--------|--------|
| **처리 방식** | **BackgroundTasks (추천)** | Message Queue |
| **명령 방식** | **Slash Command (추천)** | Bot Mention |
| **인증 UX** | **Simple Web Page + DM (추천)** | Deep Link |

### 💡 AI 추천 안
> **BackgroundTasks + Slash Command + Web Page/DM** 조합을 강력 추천합니다.
> 가장 구현이 빠르고 안정적이며, 사용자가 명확하게 시스템을 제어할 수 있습니다. LLM 기반 대화는 추후 `@Panager` 멘션 이벤트 핸들러를 추가하여 확장할 수 있습니다.

---

## ✅ 결정

> **처리 방식**: [ ] 방안 A (BackgroundTasks) / [x] 방안 B (Queue - Redis)
> **명령 방식**: [ ] 방안 A (Slash Command) / [ ] 방안 B (Bot Mention) / [x] 방안 C (1:1 DM)
> **인증 UX**: [ ] 방안 A (Web + DM) / [x] 방안 B (Deep Link)
>
> **결정 이유**: 확장성을 위해 Message Queue 도입, 사용자 친화적인 대화형 인터페이스(DM) 채택, 모바일 경험을 위한 Deep Link 사용.

